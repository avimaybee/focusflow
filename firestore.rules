rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Public summaries are read-only for everyone
    match /publicSummaries/{slug} {
      allow read: if true;
      allow write: if false; // Nobody can write to public summaries directly
    }

    // User data
    match /users/{userId} {
      // Allow a user to create, read, and update their own profile document.
      allow create, read, update: if request.auth.uid == userId;
      // Do not allow users to delete their own profile document.
      allow delete: if false;
      
      // Allow user to read/write their own summaries
      match /summaries/{summaryId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      // Allow user to read/write their own goals
      match /goals/{goalId} {
        allow read, write: if request.auth.uid == userId;
      }

      // Allow user to read/write their own study sessions
      match /studySessions/{sessionId} {
        allow read, write: if request.auth.uid == userId;
      }

      // Allow user to read/write their own quizzes
      match /quizzes/{quizId} {
         allow read, write: if request.auth.uid == userId;
      }

      // Allow user to read/write their own flashcards
      match /flashcardSets/{flashcardId} {
         allow read, write: if request.auth.uid == userId;
      }
    }
  }
}
